<div class="profile-update-container">
    <div class="profile-update-header">
        <a (click)="onBack()" class="back-btn">
            <i class="fas fa-arrow-left"></i> 返回
        </a>
        <h1>修改个人信息</h1>
    </div>

    <div class="profile-update-content">
        <form (ngSubmit)="onSubmit()" #profileForm="ngForm">
            <div class="profile-update-section">
                <h2>头像设置</h2>
                <div class="custom-avatar-upload">
                  <!-- 当前选中的头像 -->
                  <div class="current-avatar">
                    <h3>当前头像</h3>
                    <div class="avatar-preview">
                      <img [src]="selectedAvatar || avatar" [alt]="username.charAt(0) || '?'" class="preview-image">
                    </div>
                  </div>

                  <!-- 预设头像选择 -->
                  <div class="preload-avatars">
                    <div class="avatars-title">
                      <h3>选择新头像</h3>
                    </div>
                    <div class="avatars-grid">
                      <div 
                        *ngFor="let avatarItem of preloadAvatars" 
                        class="avatar-option"
                        [class.selected]="selectedAvatar === avatarItem"
                        (click)="selectAvatar(avatarItem)"
                        title="选择此头像">
                        <img [src]="avatarItem" [alt]="avatarItem" class="avatar-thumbnail">
                      </div>
                    </div>
                  </div>
                </div>
            </div>

            <div class="profile-update-section">
                <h2>基本信息</h2>
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input
                        type="text"
                        id="username"
                        name="username"
                        [(ngModel)]="username"
                        class="form-control"
                        placeholder="请输入用户名"
                        required>
                </div>

                <div class="form-group">
                    <label for="email">邮箱地址</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        [(ngModel)]="email"
                        class="form-control"
                        placeholder="请输入邮箱地址"
                        pattern="^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$"
                        required>
                </div>

              @if (errorMessage){
                <div class="error-message">
                    {{ errorMessage }}
                </div>
              }
              @if (successMessage){
                <div class="success-message">
                    {{ successMessage }}
                </div>
              }
            </div>

            <div class="profile-update-actions">
                <button type="submit" class="save-btn" [disabled]="isLoading">
                  <span>{{isLoading ? "保存中..." : "保存更改"}}</span>
                </button>
            </div>
        </form>
    </div>
</div>