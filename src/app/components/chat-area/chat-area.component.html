<!-- chat-area.component.html -->
<div class="chat-container">
  <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
  <div class="chat-header">
    <div class="contact-info">
      <div class="avatar">
        @if (selectedContact?.avatar){
          <img src="{{selectedContact?.avatar}}" alt="{{ selectedContact?.username?.charAt(0) || '?' }}" style="border-radius: 50%; width: 100%; height: 100%">
        } @else {
          <label>{{ selectedContact?.username?.charAt(0) || '?' }}</label>
        }
      </div>
      <div class="contact-details">
        <div class="contact-name">{{ selectedContact?.username || 'è¯·é€‰æ‹©ä¸€ä¸ªè”ç³»äºº' }}</div>
        <div class="contact-status">{{ selectedContact?.online || '' }}</div>
      </div>
    </div>
  </div>

  <!-- ä¸­é—´æ¶ˆæ¯åŒº -->
  <div class="chat-messages" #chatMessagesContainer *ngIf="selectedContact; else noContactSelected">
    @for (message of messages; track message.id) {
    <div class="message-bubble" [class.own-message]="isNewMessage(message)"
      [class.other-message]="isNewReceivedMessage(message)" [class.new-message]="isNewMessage(message)"
      [class.new-received-message]="isNewReceivedMessage(message)">
      <div class="message-content">
        {{ message.content }}
      </div>
      <div class="message-time">{{ message.timestamp }}</div>
    </div>
    }
  </div>

  <ng-template #noContactSelected>
    <div class="no-contact-selected">
      <div class="welcome-message">
        <h2>æ¬¢è¿ä½¿ç”¨ CloudChat</h2>
        <p>è¯·é€‰æ‹©ä¸€ä¸ªè”ç³»äººå¼€å§‹èŠå¤©</p>
        <div class="welcome-icon">ğŸ’¬</div>
      </div>
    </div>
  </ng-template>

  <!-- åº•éƒ¨è¾“å…¥åŒº -->
  @if (selectedContact){
  <div class="input-area">
    <div class="input-container">
      <div class="input-actions">
        <button class="icon-button" (click)="appendEmoji()" [disabled]="!selectedContact">ğŸ˜Š</button>
        <button class="icon-button" (click)="sendFile()" [disabled]="!selectedContact">ğŸ“</button>
        <button class="icon-button" (click)="sendImage()" [disabled]="!selectedContact">ğŸ¤</button>
      </div>
      <textarea class="message-input" placeholder="{{selectedContact ? 'è¾“å…¥æ¶ˆæ¯...' : 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè”ç³»äºº'}}"
        [(ngModel)]="newMessage" (keydown.enter)="sendMessage($event)" [disabled]="!selectedContact"></textarea>
    </div>
    <button class="send-button" (click)="sendMessage($event)" [disabled]="!selectedContact || !newMessage.trim()">å‘é€</button>
  </div>
  }
</div>
