<div class="contact-list-container">
  <!-- 顶部搜索区 -->
  <div class="search-section">
    <div class="search-input-wrapper">
      <i class="fas fa-search search-icon"></i>
      <input type="text" class="search-input" placeholder="搜索联系人 / 聊天记录">
    </div>
    <div class="action-buttons">
      <button class="icon-button" title="添加联系人" (click)="showAddContact()">
        <i class="fas fa-user-plus">+</i>
      </button>
      <a routerLink="/settings" class="icon-button" title="设置">
        @if (currentUser){
              @if (currentUser.avatar){
                <div>
                  <img src="{{currentUser.avatar}}" alt="{{ currentUser.username.charAt(0) || '?' }}" style="border-radius: 50%; width: 100%; height: 100%">
                </div>
              } @else {
                <label>{{ currentUser.username.charAt(0) || '?' }}</label>
              }
        }
      </a>
    </div>
  </div>

  <!-- 联系人列表 -->
  <div class="contacts-list">
    @for (contact of contacts; track contact.contactId) {
      <div class="contact-item"
           [class.selected]="contact.contactId === selectedContactId"
           (click)="selectContact(contact)">
        <div class="avatar-container">
          <div class="avatar" [class.online]="contact.online">
            {{ contact.username.charAt(0).toUpperCase() }}
          </div>
        </div>
        <div class="contact-info">
          <div class="contact-name">{{ contact.username }}</div>
          <div class="last-message">{{ getLastMessageContent(contact) || '暂无消息' }}</div>
        </div>
        <div class="contact-meta">
          <div class="timestamp">{{ getLastMessageTime(contact) }}</div>
          @if (getUnreadCount(contact) > 0) {
            <div class="unread-count">
              {{ getUnreadCount(contact) > 99 ? '99+' : getUnreadCount(contact) }}
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
