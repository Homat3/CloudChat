<div class="add-contact-overlay" (click)="closeOverlay($event)">
  <div class="add-contact-modal">
    <h2>æ·»åŠ è”ç³»äºº</h2>
    <div class="search-options">
      <div class="search-option" [class.active]="searchType === 'id'">
        <input
          type="radio"
          id="searchById"
          name="searchType"
          value="id"
          [(ngModel)]="searchType"
          (change)="onSearchTypeChange()">
        <label for="searchById">é€šè¿‡IDæœç´¢</label>
      </div>
      <div class="search-option" [class.active]="searchType === 'username'">
        <input
          type="radio"
          id="searchByUsername"
          name="searchType"
          value="username"
          [(ngModel)]="searchType"
          (change)="onSearchTypeChange()">
        <label for="searchByUsername">é€šè¿‡ç”¨æˆ·åæœç´¢</label>
      </div>
    </div>

    <div class="search-input-container">
      @if (searchType === 'id'){
        <input
          type="number"
          [(ngModel)]="searchId"
          placeholder="ğŸ”è¾“å…¥ç”¨æˆ·ID"
          class="search-input">
      } @else if (searchType === 'username'){
        <input
          type="text"
          [(ngModel)]="searchUsername"
          placeholder="ğŸ”è¾“å…¥ç”¨æˆ·å"
          class="search-input">
      } @else {
        <label> Error </label>
      }

      <button (click)="searchContact()" class="search-button">æœç´¢</button>
    </div>

    @if (searchResult && searchResult.length > 0){
      <div class="search-result">
        <div class="result-header">
          <h3>æœç´¢ç»“æœ</h3>
          <select [(ngModel)]="selectedContactId" class="contact-select">
            <option value="">è¯·é€‰æ‹©è¦æ·»åŠ çš„è”ç³»äºº</option>
            @for (contact of searchResult; track contact.contactId){
              <option>
                @if (contact.avatar){
                  <img ngSrc="{{contact.avatar}}" alt="{{ contact.username.charAt(0) || '?' }}" fill>
                } @else {
                  <label>{{ contact.username.charAt(0) || '?' }}</label>
                }
                {{ contact.username }} <br> (ID: {{ contact.contactId }})
              </option>
            }
          </select>
          <button
            (click)="addSelectedContact()"
            [disabled]="!selectedContactId"
            class="add-button">
            æ·»åŠ è”ç³»äºº
          </button>
        </div>
      </div>
    }

    @if (searchResult && searchResult.length === 0){
      <div class="no-results">
        æœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·
      </div>
    }

    @if (searchError){
      <div class="error-message">
        {{ searchError }}
      </div>
    }

    <div class="modal-actions">
      <button (click)="close()" class="cancel-button">å–æ¶ˆ</button>
    </div>
  </div>
</div>
