# CloudChat 登录业务逻辑
## 客户端
### 一、检查令牌
客户端在加载登录注册界面前，检查本地是否有保存令牌。
若有令牌，则向服务端发送令牌登录请求；若没有令牌，直接加载登录注册界面。

若令牌登录成功，则保存服务端返回的新令牌，加载应用主界面，否则加载登录注册界面。
### 二、账密登录
用户输入用户名和密码后点击“登录”按钮，向服务端发送账密登录请求，等待服务端结果。

若服务端返回登录成功，则保存服务端返回的新令牌，加载应用主界面；若服务端返回登录失败，则显示错误信息。
## 服务端
### 一、令牌登录
收到客户端令牌登录请求后，解析 JSON 字符串得到 LoginByTokenMsg 对象，查询 users 数据表，看是否存在请求登录的用户名。

若不存在请求登录的用户名，则发送 LOGIN_FAILURE 消息（LoginFailureMsg 对象的 JSON 字符串）给客户端，错误信息说明用户名不存在；若存在请求登录的用户名，则比对客户端发来的令牌与数据库中的令牌是否一致。

若令牌一致，则为用户生成一个新令牌，更新 users 数据表相应条目，发送 LOGIN_SUCCESS 消息（LoginSuccessMsg 对象的 JSON 字符串）给客户端；若令牌不一致，则发送 LOGIN_FAILURE 消息（LoginFailureMsg 对象的 JSON 字符串）给客户端，错误信息说明令牌已失效，需重新登录。
## 二、账密登录
收到客户端账密登录请求后，解析 JSON 字符串得到 LoginMsg 对象，查询 users 数据表，看是否存在请求登录的用户名。

若不存在请求登录的用户名，则发送 LOGIN_FAILURE 消息（LoginFailureMsg 对象的 JSON 字符串）给客户端，错误信息说明用户名不存在；若存在请求登录的用户名，则比对客户端发来的密码与数据库中的密码是否一致。

若密码一致，则为用户生成一个新令牌，更新 users 数据表相应条目，发送 LOGIN_SUCCESS 消息（LoginSuccessMsg 对象的 JSON 字符串）给客户端；若密码不一致，则发送 LOGIN_FAILURE 消息（LoginFailureMsg 对象的 JSON 字符串）给客户端，错误信息说明密码错误。
